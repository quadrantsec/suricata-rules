# Sagan quadrant-suricata.rules
# Copyright (c) 2009-2022. Quadrant Information Security <www.quadrantsec.com>
# All rights reserved.
#
# Please submit any custom rules or ideas to sagan-submit@quadrantsec.com or the sagan-sigs mailing list
#
#*************************************************************
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************

alert udp any any -> 12.145.241.0/24 9999 (msg:"QUADRANT Ping Packet"; flow:to_server; content:"SOFTWINK-PING-PACKET";classtype: not-suspicious;sid:20000003; rev:1;)
alert icmp any any -> 12.145.241.0/24 any (msg:"QUADRANT Ping Packet [ICMP]"; content:"SOFTWINK-PING";classtype: not-suspicious;sid:20000004; rev:1;)

# Added 20160923 by srawls - check for http connections to .su, .ml, and .tk domains

alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS  (msg: "[QUADRANT] Attempt to contact .tk domain"; content: "|2e|tk|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; reference: url,en.wikipedia.org/wiki/.tk ; sid: 9999068; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS  (msg: "[QUADRANT] Attempt to contact .ml domain"; content: "|2e|ml|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; reference: url,en.wikipedia.org/wiki/.ml ; sid: 9999069; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS  (msg: "[QUADRANT] Attempt to contact .su domain"; content: "|2e|su|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; reference: url,www.abuse.ch/?p=3581 ; sid: 9999070; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg: "[QUADRANT] Attempt to contact .top domain"; content: "|2e|top|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; pcre: "/Host: .*\.top/H"; content:!"www.frivgames.top"; classtype: bad-unknown ; reference: url,en.wikipedia.org/wiki/.top ; sid: 9999072; rev:2;)

alert tcp any [21,22,23,25,53,80,443,8080] -> any !3389 (msg:"[QUADRANT] RDP HANDSHAKE [Tunneled msts] - Possible RDP bypass attempt"; dsize:<65; content:"|03 00 00|"; depth:3; content:"|e0|"; distance:2; within:1; content:"Cookie: mstshash="; distance:5; within:17; reference:url,fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html; classtype: attempted-user;sid:10000283; rev:1;)
alert tcp any [21,22,23,25,53,80,443,8080] -> any !3389 (msg:"[QUADRANT] RDP HANDSHAKE [Tunneled] - Possible RDP bypass attempt"; flow:established; content:"|c0 00|Duca"; depth:250; content:"rdpdr"; content:"cliprdr"; reference:url,fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html; classtype: attempted-user; sid:10000284; rev:1;)

#added by jgrove 30jul2019 to replace sid 13586

alert tcp !$INTERNAL_NETWORK !22 -> $INTERNAL_NETWORK !22 (msg:"[QUADRANT] SSH server response detected on non-standard port from external server"; flow:to_client,established; content:"SSH-"; depth:4; nocase; pcre:"/^SSH-[12]\.\d+/smi"; metadata:policy max-detect-ips drop; threshold: type limit, track by_src, count 1, seconds 604800; reference:url,www.ietf.org/rfc/rfc4251.txt; classtype:non-standard-protocol; sid:10000285; rev:2;)
alert tcp $INTERNAL_NETWORK !22 -> !$INTERNAL_NETWORK !22 (msg:"[QUADRANT] SSH server response detected on non-standard port from internal server"; flow:to_client,established; content:"SSH-"; depth:4; nocase; pcre:"/^SSH-[12]\.\d+/smi"; metadata:policy max-detect-ips drop; threshold: type limit, track by_src, count 1, seconds 604800; reference:url,www.ietf.org/rfc/rfc4251.txt; classtype:non-standard-protocol; sid:10000286; rev:1;)

alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg: "[QUADRANT] Attempt to contact Utorrent domain (download-hr.utorrent.com)"; content: "download-hr.utorrent.com|0D 0A|"; nocase; http_header; content: "host|3a|"; nocase; http_header; classtype: bad-unknown ; sid: 10000287; rev:1;)
#APT34 APT 35 jgrove

# -- From Fireeye breach - 20201208

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle USAToday Server]"; flow:from_server,established; content:"{\"navgd\":\"<div class=gnt_n_dd_ls_w><div class=gnt_n_dd_nt>ONLY AT USA TODAY:</div><div class=gnt_n_dd_ls><a class=gnt_n_dd_ls_a href=https://supportlocal.usatoday.com/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000300; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle USAToday Server]"; content:"HTTP/1."; depth:7; content:"Connection: close"; content:"Content-Type: application/json\; charset=utf-8"; content:"Content-Security-Policy: upgrade-insecure-requests"; content:"Strict-Transport-Security: max-age=10890000"; content:"Cache-Control: public, immutable, max-age=315360000"; content:"Accept-Ranges: bytes"; content:"X-Cache: HIT, HIT"; content:"X-Timer: S1593010188.776402,VS0,VE1"; content:"Vary: X-AbVariant, X-AltUrl, Accept-Encoding"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000301; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Server]"; content:"HTTP/1."; depth:7; content:"Content-Type: text/json|0d 0a|"; content:"Server: Microsoft-IIS/10.0|0d 0a|"; content:"X-Powered-By: ASP.NET|0d 0a|"; content:"Cache-Control: no-cache, no-store, max-age=0, must-revalidate|0d 0a|"; content:"Pragma: no-cache|0d 0a|"; content:"X-Frame-Options: SAMEORIGIN|0d 0a|"; content:"Connection: close|0d 0a|"; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000302; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES GET]"; content:"GET"; depth:3; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US,en\;q=0.5"; content:"nyt-a="; content:"nyt-gdpr=0\;nyt-purr=cfh\;nyt-geo=US}"; fast_pattern; content:"|0d 0a|Cookie:"; pcre:"/^GET\s(?:\/ads\/google|\/vi-assets\/static-assets|\/v1\/preferences|\/idcta\/translations|\/v2\/preferences)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000303; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Stager]"; content:"T "; offset:2; depth:3; content:"Accept: */*"; content:"Accept-Language: en-US"; content:"Accept-Encoding: gzip, deflate"; content:"Cookie: SIDCC=AN0-TYutOSq-fxZK6e4kagm70VyKACiG1susXcYRuxK08Y-rHysliq0LWklTqjtulAhQOPH8uA"; pcre:"/\/api\/v1\/user\/(?:512|124)\/avatar/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000304; rev:1;)

alert tcp any any -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.GORAT.[SID1]"; content:"GET"; depth:3; content:"|0d 0a|Cookie: SID1="; content:!"|0d 0a|Referer:"; content:!"|0d 0a|Accept"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000305; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice Server]"; content:"HTTP/1."; depth:7; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":\""; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000306; rev:1;)

alert tcp any any -> any 443 (msg:"[FIREEYE-IOC] Backdoor.SSL.BEACON.[CSBundle Ajax]"; content:"|16 03|"; depth:2; content:"US"; content:"US"; distance:0; content:"ajax.microsoft.com"; content:"ajax.microsoft.com"; distance:0; content:"Seattle"; content:"Seattle"; distance:0; content:"Microsoft"; content:"Microsoft"; distance:0; content:"Information Technologies"; content:"Information Technologies"; distance:0; content:"WA"; content:"WA"; distance:0; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000307; rev:1;)

alert tcp $HOME_NET any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[Yelp GET]"; flow:to_server; content:"GET "; depth:4; content:"&parent_request_id="; distance:0; within:256; fast_pattern; content:" HTTP/1"; distance:0; within:1024; content:"|0d 0a|Sec-Fetch-Dest: empty|0d 0a|"; distance:0; within:256; content:"request_origin=user"; offset:0; depth:256; pcre:"/^GET [^\r\n]{0,256}&parent_request_id=(?:[A-Za-z0-9_\/\+\-%]{128,1024})={0,2}[^\r\n]{0,256} HTTP\/1\.[01]/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000308; rev:1;)

alert udp any 53 -> any any (msg:"[FIREEYE-IOC] Backdoor.DNS.BEACON.[CSBundle DNS]"; content:"|00 01 00 01|"; offset:4; depth:4; content:"|0a|_domainkey"; distance:0; content:"|00 00 10 00 01 c0 0c 00 10 00 01 00 00 00 02 01 00 ff|v=DKIM1\; p="; distance:0; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000309; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle CDN GET]"; content:"GET"; depth:3; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"client-="; content:"\;auth=1}"; content:"Cookie:"; pcre:"/^GET\s(?:\/v1\/queue|\/v1\/profile|\/v1\/docs\/wsdl|\/v1\/pull)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000310; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle USAToday GET]"; content:"GET"; depth:3; content:"Connection: close|0d 0a|"; content:"Accept: */*|0d 0a|"; content:"gnt_ub=86\;gnt_sb=18\;usprivacy=1YNY\;DigiTrust.v1.identity="; content:"%3D\;GED_PLAYLIST_ACTIVITY=W3sidSI6IkZtTWUiLCJ0c2wiOjE1OTMwM\;"; content:"Cookie:"; pcre:"/^GET\s(?:\/USAT-GUP\/user\/|\/entertainment\/|\/entertainment\/navdd-q1a2z3Z6TET4gv2PNfXpaJAniOzOajK7M\.min\.json|\/global-q1a2z3C4M2nNlQYzWhCC0oMSEFjQbW1KA\.min\.json|\/life\/|\/news\/weather\/|\/opinion\/|\/sports\/|\/sports\/navdd-q1a2z3JHa8KzCRLOQAnDoVywVWF7UwxJs\.min\.json|\/tangstatic\/js\/main-q1a2z3b37df2b1\.min\.js|\/tangstatic\/js\/pbjsandwich-q1a2z300ab4198\.min\.js|\/tangstatic\/js\/pg-q1a2z3bbc110a4\.min\.js|\/tangsvc\/pg\/3221104001\/|\/tangsvc\/pg\/5059005002\/|\/tangsvc\/pg\/5066496002\/|\/tech\/|\/travel\/)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000311; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original POST]"; content:"POST"; depth:4; content:"Accept: */*|0d 0a|"; content:"Accept-Language: en-US|0d 0a|"; content:"Accept-Encoding: gzip, deflate|0d 0a|"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; pcre:"/^POST\s(?:\/v4\/links\/check-activity\/check|\/v1\/stats|\/gql|\/api2\/json\/check\/ticket|\/1.5\/95648064\/storage\/history|\/1.5\/95648064\/storage\/tabs|\/u\/0\/_\/og\/botguard\/get|\/ev\/prd001001|\/ev\/ext001001|\/gp\/aw\/ybh\/handlers|\/v3\/links\/ping-beat\/check)/"; content:"ses-"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000312; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice POST]"; content:"POST /v1/push"; depth:13; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; content:"cli"; content:"l-"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000313; rev:1;)

alert tcp any any -> any [139,445] (msg:"[FIREEYE-IOC] M.HackTool.SMB.Impacket-Obfuscation.[Service Names]"; content:"|ff 53 4d 42|"; offset:4; depth:4; pcre:"/(?:\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x55\x00\x70\x00\x64\x00\x61\x00\x74\x00\x65\x00\x20\x00\x43\x00\x6f\x00\x6e\x00\x74\x00\x72\x00\x6f\x00\x6c\x00\x20\x00\x53\x00\x65\x00\x72\x00\x76\x00\x69\x00\x63\x00\x65|\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x31\x00\x30\x00\x20\x00\x44\x00\x65\x00\x66\x00\x65\x00\x6e\x00\x64\x00\x65\x00\x72|\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x4c\x00\x69\x00\x63\x00\x65\x00\x6e\x00\x73\x00\x65\x00\x20\x00\x4b\x00\x65\x00\x79\x00\x20\x00\x41\x00\x63\x00\x74\x00\x69\x00\x76\x00\x61\x00\x74\x00\x69\x00\x6f\x00\x6e|\x4f\x00\x66\x00\x66\x00\x69\x00\x63\x00\x65\x00\x20\x00\x33\x00\x36\x00\x35\x00\x20\x00\x50\x00\x72\x00\x6f\x00\x78\x00\x79|\x4d\x00\x69\x00\x63\x00\x72\x00\x6f\x00\x73\x00\x6f\x00\x66\x00\x74\x00\x20\x00\x53\x00\x65\x00\x63\x00\x75\x00\x72\x00\x69\x00\x74\x00\x79\x00\x20\x00\x43\x00\x65\x00\x6e\x00\x74\x00\x65\x00\x72|\x4f\x00\x6e\x00\x65\x00\x44\x00\x72\x00\x69\x00\x76\x00\x65\x00\x20\x00\x53\x00\x79\x00\x6e\x00\x63\x00\x20\x00\x43\x00\x65\x00\x6e\x00\x74\x00\x65\x00\x72|\x42\x00\x61\x00\x63\x00\x6b\x00\x67\x00\x72\x00\x6f\x00\x75\x00\x6e\x00\x64\x00\x20\x00\x41\x00\x63\x00\x74\x00\x69\x00\x6f\x00\x6e\x00\x20\x00\x4d\x00\x61\x00\x6e\x00\x61\x00\x67\x00\x65\x00\x72|\x53\x00\x65\x00\x63\x00\x75\x00\x72\x00\x65\x00\x20\x00\x54\x00\x6f\x00\x6b\x00\x65\x00\x6e\x00\x20\x00\x4d\x00\x65\x00\x73\x00\x73\x00\x61\x00\x67\x00\x69\x00\x6e\x00\x67\x00\x20\x00\x53\x00\x65\x00\x72\x00\x76\x00\x69\x00\x63\x00\x65|\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x20\x00\x55\x00\x70\x00\x64\x00\x61\x00\x74\x00\x65)/R"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000314; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Stager 2]"; content:"HTTP/1."; depth:7; content:"Content-Type: text/json|0d 0a|"; content:"Server: Microsoft-IIS/10.0|0d 0a|"; content:"X-Powered-By: ASP.NET|0d 0a|"; content:"Cache-Control: no-cache, no-store, max-age=0, must-revalidate|0d 0a|"; content:"Pragma: no-cache|0d 0a|"; content:"X-Frame-Options: SAMEORIGIN|0d 0a|"; content:"Connection: close|0d 0a|"; content:"Content-Type: image/gif"; content:"|01 00 01 00 00 02 01 44 00 3b|"; content:"|ff ff ff 21 f9 04 01 00 00 00 2c 00 00 00 00|"; content:"|47 49 46 38 39 61 01 00 01 00 80 00 00 00 00|"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000315; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES POST]"; content:"POST"; depth:4; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US,en\;q=0.5"; content:"id-"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; pcre:"/^POST\s(?:\/track|\/api\/v1\/survey\/embed|\/svc\/weather\/v2)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000316; rev:1;)

alert tcp $HOME_NET any -> any 88 (msg:"[FIREEYE-IOC] HackTool.TCP.Rubeus.[nonce 2]"; content:"|a7 06 02 04 6C 69 6C 00|"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000317; rev:1;)

alert tcp $HOME_NET any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[Yelp Request]"; flow:to_server; content:"T "; depth:5; content:" HTTP/1"; distance:0; within:256; content:"Cookie: hl=en|3b|bse="; distance:0; within:256; fast_pattern; content:"|3b|_gat_global=1|3b|recent_locations|3b|_gat_www=1|3b||0d 0a|"; pcre:"/Cookie: hl=en\x3bbse=(?:[A-Za-z0-9_\/\+\-]{128,1024})={0,2}\x3b_gat_global=1\x3brecent_locations\x3b_gat_www=1\x3b\r\n/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000318; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice GET]"; content:"GET"; depth:3; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"sess-="; content:"auth=0\;loc=US}"; content:"Cookie:"; pcre:"/^GET\s(?:\/updates|\/license\/eula|\/docs\/office|\/software-activation)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000319; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Server 2]"; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000320; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice POST]"; content:"POST /notification"; depth:18; content:"Accept: */*"; content:"Accept-Encoding: gzip, deflate, br"; content:"Accept-Language: en-US|0d 0a|"; content:"{\"locale\":\"en\",\"channel\":\"prod\",\"addon\":\""; content:"nid"; content:"msg-"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000321; rev:1;)

alert tcp any any -> any $HTTP_PORTS (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original GET]"; content:"GET"; depth:3; content:"Accept: */*|0d 0a|"; content:"Accept-Language: en-US|0d 0a|"; content:"Accept-Encoding: gzip, deflate|0d 0a|"; content:"Cookie:"; content:"display-culture=en\;check=true\;lbcs=0\;sess-id="; distance:0; content:"\;SIDCC=AN0-TY21iJHH32j2m\;FHBv3=B"; pcre:"/^GET\s(?:\/api2\/json\/access\/ticket|\/api2\/json\/cluster\/resources|\/api2\/json\/cluster\/tasks|\/en-us\/p\/onerf\/MeSilentPassport|\/en-us\/p\/book-2\/8MCPZJJCC98C|\/en-us\/store\/api\/checkproductinwishlist|\/gp\/cerberus\/gv|\/gp\/aj\/private\/reviewsGallery\/get-application-resources|\/gp\/aj\/private\/reviewsGallery\/get-image-gallery-assets|\/v1\/buckets\/default\/ext-5dkJ19tFufpMZjVJbsWCiqDcclDw\/records|\/v3\/links\/ping-centre|\/v4\/links\/activity-stream|\/wp-content\/themes\/am43-6\/dist\/records|\/wp-content\/themes\/am43-6\/dist\/records|\/wp-includes\/js\/script\/indigo-migrate)/"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000322; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle MSOffice Server]"; flow:from_server,established; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":\""; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000323; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES Server]"; flow:from_server,established; content:"{\"meta\":{},\"status\":\"OK\",\"saved\":\"1\",\"starttime\":17656184060,\"id\":\"\",\"vims\":{\"dtc\":\""; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000324; rev:1;)

alert udp any any -> any 88 (msg:"[FIREEYE-IOC] HackTool.UDP.Rubeus.[nonce 2]"; content:"|a7 06 02 04 6C 69 6C 00|"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000325; rev:1;)

alert udp any 53 -> any any (msg:"[FIREEYE-IOC] Backdoor.DNS.BEACON.[CSBundle DNS]"; content:"|00 01 00 01|"; offset:4; depth:4; content:"|03|"; within:15; content:"|0a|_domainkey"; distance:3; within:11; content:"|00 00 10 00 01 c0 0c 00 10 00 01 00 00 00 02 01 00 ff|v=DKIM1\; p="; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000326; rev:1;)

alert tcp any any -> any 88 (msg:"[FIREEYE-IOC] HackTool.TCP.Rubeus.[nonce]"; content:"|05|"; depth:30; content:"|0a|"; distance:4; within:1; content:"Z"; content:"|6C 69 6C 00|"; within:25; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000327; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle NYTIMES Server]"; content:"HTTP/1."; depth:7; content:"Accept-Ranges: bytes"; content:"Age: 5806"; content:"Cache-Control: public,max-age=31536000"; content:"Content-Encoding: gzip"; content:"Content-Length: 256398"; content:"Content-Type: application/javascript"; content:"Server: UploadServer"; content:"Vary: Accept-Encoding, Fastly-SSL"; content:"x-api-version: F-X"; content:"x-cache: HIT"; content:"x-Firefox-Spdy: h2"; content:"x-nyt-route: vi-assets"; content:"x-served-by: cache-mdw17344-MDW"; content:"x-timer: S1580937960.346550,VS0,VE0"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000328; rev:1;)

alert tcp any $HTTP_PORTS -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.BEACON.[CSBundle Original Server 3]"; content:"{\"alias\":\"apx\",\"prefix\":\"\",\"suffix\":null,\"suggestions\":[],\"responseId\":\"15QE9JX9CKE2P\",\"addon\": \""; content:"\",\"shuffled\":false}"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000329; rev:1;)

alert udp any any -> any 88 (msg:"[FIREEYE-IOC] HackTool.UDP.Rubeus.[nonce]"; content:"|05|"; depth:30; content:"|0a|"; distance:4; within:1; content:"Z"; content:"|6C 69 6C 00|"; within:25; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000330; rev:1;)

alert tcp any any -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.GORAT.[POST]"; content:"POST / HTTP/1.1"; depth:15; content:"Connection: upgrade"; content:"|0d 0a|Upgrade: tcp/1|0d 0a|"; content:!"|0d 0a|Referer:"; content:!"|0d 0a|Accept"; content:!"|0d 0a|Cookie:"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000331; rev:1;)

# This rule cause loopback & noise issues - Champ Clark III / 20201208
#
# alert tcp any any -> any any (msg:"[FIREEYE-IOC] HackTool.TCP.Rubeus.[User32LogonProcesss]"; flow:to_server; content:"User32LogonProcesss"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000332; rev:1;)

alert tcp any any -> any any (msg:"[FIREEYE-IOC] Backdoor.HTTP.GORAT.[Build ID]"; content:"aqlKZ7wjzg0iKM00E1WB/jq9_RA46w91EKl9A02Dv/nbNdZiLsB1ci8Ph0fb64/9Ks1YxAE86iz9A0dUiDl"; reference:url,www.fireeye.com/blog/threat-research/2020/12/unauthorized-access-of-fireeye-red-team-tools.html; classtype:targeted-activity; sid:10000333; rev:1;)

## --- FireEye "Sunburst" modified rules - 20201214 (https://github.com/quadrantsec/fireeye-sunburst)

# https://github.com/fireeye/sunburst_countermeasures/blob/main/LICENSE.txt
# Modified by Champ Clark III @ Quadrant Information Security ( 12/14/2020 )

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"/swip/Events HTTP/1"; within:100; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000334; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"/swip/upd/SolarWinds.CortexPlugin.Components.xml"; distance:0; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000335; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:".avsvmcloud.com"; distance:0; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000336; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"swip/Upload.ashx HTTP/1"; within:100; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000337; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"/swip/upd/"; within:75; content:" HTTP/1."; distance:0; content:"Host: "; content:!".solarwinds.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000338; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"avsvmcloud.com"; distance:0; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000358; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"digitalcollege.org"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000339; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"freescanonline.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000359; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"deftsecurity.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000340; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"thedoccloud.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000341; rev:1;)

alert tcp any any <> any 443 (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"|16 03|"; depth:2; content:"|55 04 03|"; distance:0; content:"virtualdataserver.com"; within:50; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000342; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"digitalcollege.org"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000343; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"freescanonline.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000344; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"deftsecurity.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000345; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"thedoccloud.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000346; rev:1;)

alert tcp any any -> any any (msg:"[FireEye SUNBURST] Backdoor.SUNBURST"; content:"T "; offset:2; depth:3; content:"Host:"; content:"virtualdataserver.com"; within:100; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000347; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"incomeupdate.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000348; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"zupertech.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000349; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"databasegalore.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000350; rev:1;)

alert tcp $HOME_NET any -> any 443 (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"|16 03 03|"; depth:3; content:"panhardware.com"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000351; rev:1;)

alert tcp $HOME_NET any -> any any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"POST"; depth:4; content:"|0d 0a 0d 0a|name=\""; content:"\"\;filename=\""; content:"\"|0a|Content-Type:"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000352; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; content:"HTTP/1."; depth:7; content:"Server: nginx/1.14.0 (Ubuntu)"; distance:0; content:"Connection: close"; distance:0; content:"Cache-Control: max-age=300, must-revalidate"; distance:0; content:"X-Content-Type-Options: nosniff"; distance:0; content:"X-AspNetMvc-Version: 3.0"; distance:0; content:"X-AspNet-Version: 4.0.30319"; distance:0; content:"X-Powered-By: ASP.NET"; distance:0; content:"Content-Length: "; content:"|0d 0a|"; distance:6; within:4; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000353; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<title>Woman-Five-How-To-Why-Your-Celebrating-Learn-Brand</title>"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000354; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<p>Companies-Best-Man-Vendors-Best</p>"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000355; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<meta name=\"msvalidate.01\" content=\"ECEE9516DDABFC7CCBBF1EACC04CAC20\">"; content:"<meta name=\"google-site-verification\" content=\"CD5EF1FCB54FE29C838ABCBBE0FA57AE\">"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000356; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"[FireEye SUNBURST] Backdoor.BEACON"; flow:from_server; content:"<p>Million-Support-Years-Week-Agents</p>"; classtype:trojan-activity; reference: url,www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html; sid:10000357; rev:1;)

# Created by Steven Drenning @ Quadrant Information Security

alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"noc-service-streamer.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000360; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"fbcdnads.live"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000361; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"hilocake.info"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000362; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"backxercise.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000363; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"winmslaf.xyz"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000364; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"service-deamon.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000365; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"online-affiliate-mon.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000366; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"codeingasmylife.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000367; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"kenoratravels.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000368; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"weathercheck.digital"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000369; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"colorpallatess.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000370; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"library-update.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000371; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"online-source-validate.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000372; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"grayhornet.com"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000373; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"johnshopkin.net"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000374; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"eulenformacion.com "; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000375; rev:1;)
alert dns $HOME_NET any -> any 53 (msg:"[DevilsTongue] DNS Query"; dns.query; content:"pochtarossiy.info"; nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/; classtype:trojan-activity; sid:10000376; rev:1;)
alert tcp any any -> $HOME_NET any (msg:"[DevilsTongue] FileHash For Physmem.sys Detected"; content:"event_type|22 3a 22|fileinfo"; content:"c299063e3eae8ddc15839767e83b9808fd43418dc5a1af7e4f44b97ba53fbd3d"; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware; classtype:trojan-activity; sid:10000377; rev:1;)
alert tcp any any -> $HOME_NET any (msg:"[DevilsTongue] File "WimBootConfigurations.ini" Detected"; content:"event_type|22 3a 22|fileinfo"; content:"WimBootConfigurations.ini";nocase; reference:url,microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware; classtype:trojan-activity; sid:10000378; rev:1;)


alert icmp $HOME_NET any -> any any (msg:"ET MALWARE Pingback cmd Command Issued"; dsize:>787; itype:8; content:"cmd"; depth:10; reference:url,www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel/; reference:md5,264c2ede235dc7232d673d4748437969; classtype:trojan-activity; sid:1000379; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_10, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2021_14_10;)

# More Log4j stuff.  Rule by S. Desorbo,  add by Champ Clark [2021/12/12]

alert ip any any -> any any (msg:"[QUADRANT] Apache log4j RCE Attempt with String Blocking Avoidance (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b 6a 6e 64 69 3a 24 7b|"; nocase; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; threshold: type limit, track by_both, seconds 3600, count 1; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; classtype:attempted-admin; sid:1000380; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_12;)

#alert http $INTERNAL_NETWORK any -> !$INTERNAL_NETWORK any (msg:"[QUADRANT] log4j .class FILE DOWNLOAD (CVE-2021-44228) CRITICAL AND CALL"; flow:established,to_server; http.method; content:"GET"; nocase; http.uri; content:".Class"; nocase; content:!".Classic"; nocase; threshold: type limit, track by_both, seconds 3600, count 1; reference:url,lunasec.io/docs/blog/log4j-zero-day/; classtype:attempted-admin; sid:1000381; rev:1;)

#SID 1000382 tracks any outbound connection to an IP seen performing log4j activity via an xbit defined as "log4j" -S. DeSorbo 2021/12/15

# Causing legit traffic to be blocked

##alert ip $INTERNAL_NETWORK any -> any any (msg:"[QUADRANT] CORRELATED Log4j: Possible outbound log4j response detected. (CVE-2021-44228)"; flow:established,to_server; xbits:isset, log4j, track ip_dst, expire 20; threshold: type limit, track by_both, seconds 3600, count 1; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; classtype:attempted-admin; sid:1000382; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_13;)


#========================================================================================================
#Emerging Threats References
#	https://rules.emergingthreatspro.com/open/
#	https://community.emergingthreats.net/
#========================================================================================================
pass http any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (http ldap) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldap|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000383; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass http any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (http rmi) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|rmi|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000384; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp ldap) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldap|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000385; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp rmi) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|rmi|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000386; rev:1; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp ldap) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|ldap|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000387; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp rmi) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|rmi|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000388; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp dns) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|dns|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000389; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp dns) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|dns|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000390; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass http any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (http dns) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|dns|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000391; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp ldaps) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|ldaps|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000392; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp ldaps) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldaps|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000393; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass http any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (http ldaps) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|ldaps|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000394; rev:2; metadata:attack_target Server, created_at 2021_12_10, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_10;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (udp iiop) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|iiop|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,202 -44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000395; rev:2; metadata:attack_target Server, created_at 2021_12_11, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_11;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt (tcp iiop) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|iiop|3a 2f 2f|"; nocase; fast_pattern; threshold: type limit, track by_src, seconds 3600, count 1; xbits:set, log4j, track ip_src, expire 3600; reference:url,lunasec.io/docs/blog/log4j-zero-day/; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000396; rev:2; metadata:attack_target Server, created_at 2021_12_11, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_11;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - lower/upper TCP Bypass M1 (CVE-2021-44228)"; flow:established,to_server; content:"%7bjndi%3a"; nocase; fast_pattern; pcre:"/^(l|r|d|(\x24|%24)(\x7b|%7b)(lower|upper)(\x3a|%3a)(l|r|d)(\x7d|%7d))(d|n|m|(\x24|%24)(\x7b|%24)(lower|upper)(\x3a|%3a)(d|n|m)(\x7d|%7d))(a|i|s|(\x24|%24)(\x7b|%7b)(lower|upper)(\x3a|%3a)(a|i|s)(\x7d|%7d))(p|(\x24|%24)(\x7b|%7b)(lower|upper)(\x3a|%3a)p(\x7d|%7d))/Ri"; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000397; rev:2; metadata:attack_target Server, created_at 2021_12_11, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - 2021/12/12 Obfuscation Observed M2 (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|"; content:"|24 7b 3a 3a|"; distance:0; within:300; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000398; rev:1; metadata:attack_target Server, created_at 2021_12_12, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_12;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - 2021/12/12 Obfuscation Observed M2 (CVE-2021-44228)"; content:"|24 7b|"; content:"|24 7b 3a 3a|"; distance:0; within:300; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000399; rev:1; metadata:attack_target Server, created_at 2021_12_12, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_12;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - 2021/12/13 Obfuscation Observed (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|"; pcre:"/^(j|\x24\x7b(lower|upper)\x3aj\x7d|\x24\x7b\x3a\x3a\-j\x7d)(n|\x24\x7b(lower|upper)\x3an\x7d|\x24\x7b\x3a\x3a\-n\x7d)/Ri"; content:"|3a|"; distance:0; content:"|24 7b|env|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000400; rev:1; metadata:attack_target Server, created_at 2021_12_13, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_13;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - AWS Access Key Disclosure (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|"; pcre:"/^(j|\x24\x7b(lower|upper)\x3aj\x7d|\x24\x7b\x3a\x3a\-j\x7d)(n|\x24\x7b(lower|upper)\x3an\x7d|\x24\x7b\x3a\x3a\-n\x7d)/Ri"; content:"|3a|"; distance:0; content:"|24 7b|env|3a|AWS_ACCESS_KEY_ID"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000401; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - lower/upper TCP Bypass M2 (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; pcre:"/^(l|r|d|\x24\x7b(lower|upper)\x3a(l|r|d)\x7d)(d|n|m|\x24\x7b(lower|upper)\x3a(d|n|m)\x7d)(a|i|s|\x24\x7b(lower|upper)\x3a(a|i|s)\x7d)(p|\x24\x7b(lower|upper)\x3a(p)\x7d)/Ri"; content:"|3a 2f 2f|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000402; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - lower/upper UDP Bypass M2 (CVE-2021-44228)"; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; pcre:"/^(l|r|d|\x24\x7b(lower|upper)\x3a(l|r|d)\x7d)(d|n|m|\x24\x7b(lower|upper)\x3a(d|n|m)\x7d)(a|i|s|\x24\x7b(lower|upper)\x3a(a|i|s)\x7d)(p|\x24\x7b(lower|upper)\x3a(p)\x7d)/Ri"; content:"|3a 2f 2f|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000403; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested lower (tcp) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b 24 7b|lower|3a 24 7b|lower|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000404; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested lower (udp) (CVE-2021-44228)"; content:"|24 7b 24 7b|lower|3a 24 7b|lower|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000405; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested upper (tcp) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b 24 7b|upper|3a 24 7b|upper|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000406; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Apache log4j RCE Attempt - Nested upper (udp) (CVE-2021-44228)"; content:"|24 7b 24 7b|upper|3a 24 7b|upper|3a|jndi"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000407; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (tcp nis) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|nis|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000408; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (udp nis) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|nis|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000409; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (tcp nds) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|nds|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000410; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (udp nds) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|nds|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000411; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (tcp corba) (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|corba|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000412; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt (udp corba) (CVE-2021-44228)"; content:"|24 7b|jndi|3a|corba|3a|"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000413; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Base64 jndi (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|base64|3a|JHtqbmRp"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000414; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Base64 jndi (CVE-2021-44228)"; content:"|24 7b|base64|3a|JHtqbmRp"; fast_pattern; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:attempted-admin; sid:1000415; rev:1; metadata:attack_target Server, created_at 2021_12_14, cve CVE_2021_44228, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_12_14;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|3a 2f 2f|"; distance:0; within:20; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000416; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol (CVE-2021-44228)"; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|3a 2f 2f|"; distance:0; within:20; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000417; rev:2; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol upper Bypass (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|24 7b|upper|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000418; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass udp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol upper Bypass (CVE-2021-44228)"; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|24 7b|upper|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000419; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)

pass tcp any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"[QUADRANT] Possible Apache log4j RCE Attempt - Any Protocol lower Bypass (CVE-2021-44228)"; flow:established,to_server; content:"|24 7b|jndi|3a|"; nocase; fast_pattern; content:"|24 7b|lower|3a|"; distance:0; xbits:set, log4j, track ip_src, expire 3600; reference:cve,2021-44228; reference:url,rules.emergingthreatspro.com/open/; reference:url,community.emergingthreats.net; classtype:misc-activity; sid:1000420; rev:1; metadata:created_at 2021_12_11, cve CVE_2021_44228, former_category HUNTING, updated_at 2021_12_11;)
#========================================================================================================

alert ip $INTERNAL_NETWORK any -> [$EXTERNAL_NET,!$INTERNAL_NETWORK] [389, 1389, 636, 1636, 1730, 3269, 3268, 3407, 6301] (msg:"[QUADRANT] Outbound Traffic over LDAP Port - Suspicious Traffic."; flow:established,to_server; threshold: type limit, track by_src, seconds 86400, count 10; reference:cve,2021-44228; classtype:attempted-admin; sid:1000422; rev:1;)

alert tcp $INTERNAL_NETWORK any -> any any (msg:"[QUADRANT] LDAP Bind Request NO ALERT"; flow:established,to_server; content:"|30 0c 02 01 01 60|"; depth:6; flowbits:set,ldap.bind; flowbits:noalert; classtype:protocol-command-decode; metadata:created_at 2021_12_16, updated_at 2021_12_16; sid:1000423; rev:1;)

alert tcp any any -> $INTERNAL_NETWORK any (msg:"[QUADRANT] Java class download over LDAP (CVE-2021-44228)"; flow:established,to_client; flowbits:isset,ldap.bind; content:"javaClassName"; nocase; reference:cve,2021-44228; metadata:created_at 2021_12_16, updated_at 2021_12_16; classtype:attempted-admin; sid:1000424; rev:1;)

#Alerts specifically on OUTBOUND bind request attempts, does not set flowbit as the "NO ALERT" rule would have already done this.

alert tcp $INTERNAL_NETWORK any -> [$EXTERNAL_NET, !$INTERNAL_NETWORK] any (msg:"[QUADRANT] LDAP Bind Request"; flow:established,to_server; content:"|30 0c 02 01 01 60|"; depth:6; threshold: type limit, track by_src, seconds 86400, count 5; classtype:protocol-command-decode; metadata:created_at 2021_12_16, updated_at 2021_12_16; sid:1000425; rev:1;)


alert tcp $EXTERNAL_NET any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to PowerShell Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "Invoke"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000426; rev: 1;)

alert tcp $EXTERNAL_NET any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to PowerShell Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IEX"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000427; rev: 1;)

alert tcp $EXTERNAL_NET any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to Suspicious Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IT_RebrowseForFile"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000428; rev: 1;)

alert tcp $EXTERNAL_NET any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to Suspicious Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IT_LaunchMethod"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000429; rev: 1;)

alert tcp $EXTERNAL_NET any -> any any (msg: "[QUADRANT] MSDT PCWDiagnostic Call to Suspicious Command Detected (CVE-2022-30190)"; content: "ms-msd|3a 2f|id"; nocase; content: "PCWDiagnostic"; nocase; content: "IT_SelectProgram"; nocase; classtype: shellcode-detect; reference: url,www.huntress.com/blog/microsoft-office-remote-code-execution-follina-msdt-bug; sid:1000430; rev: 1;)

alert icmp $HOME_NET any -> any any (msg:" ET MALWARE Pingback lock Command Issued"; dsize:>787; itype:8; content:"lock"; depth:10; reference:url,www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel/; reference:md5,264c2ede235dc7232d673d4748437969; classtype:trojan-activity; sid:10000431; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_10, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2021_14_10;)

alert icmp $HOME_NET any -> any any (msg:"ET MALWARE Pingback Filename Observed"; dsize:>787; itype:8; content:"PingBack"; depth:10; reference:url,www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel/; reference:md5,264c2ede235dc7232d673d4748437969; classtype:trojan-activity; sid:10000432; rev:1; metadata:attack_target Client_Endpoint, created_at 2021_05_10, deployment Perimeter, former_category MALWARE, performance_impact Low, signature_severity Major, updated_at 2021_14_10;)

#Added 11/04/2022 for OpenSSL 0-day detection by SDeSorbo and Bryant Smith
alert tls any any -> $INTERNAL_NETWORK any (msg:"[QUADRANT] Possible SpookySSL Certificate Observed (CVE-2022-3602)(Fox-IT)"; flow:established,from_server; content:"|2b 06 01 05 05 07 08 09|"; fast_pattern; content:"|06 03 55 1d 1e|"; content:"xn--"; content:!"|81|"; distance:-6; within:1; byte_test:2,>=,500,-6,relative; classtype:attempted-user; threshold:type limit,track by_src, count 1,seconds 3600; reference:url,www.openssl.org/news/secadv/20221101.txt; reference:url,https://github.com/fox-it/spookyssl-pcaps; sid:21004268; rev:3;)

#========================================================================================================
# 		New Suricata signatures go here.  SID range 81000000-81999999
#========================================================================================================

#alert ftp $INTERNAL_NETWORK any -> !$INTERNAL_NETWORK any (msg:"[QUADRANT] External FTP Connection Established"; flow:established,to_server; classtype:policy-violation; sid:81000000; rev:1;)

alert ftp $INTERNAL_NETWORK any -> !$INTERNAL_NETWORK any (msg:"[QUADRANT] Possible data exfil via FTP"; flow:established,to_server; content:"STOR"; offset:0; depth:4; threshold:type both,track by_both, count 50, seconds 300; classtype:trojan-activity; sid:81000001; rev:1;)

alert ftp $INTERNAL_NETWORK any -> !$INTERNAL_NETWORK any (msg:"[QUADRANT] Multiple directory listing via LIST command"; flow:established,to_server; content:"LIST"; offset:0; depth:4; threshold:type both,track by_both, count 50, seconds 300; classtype:trojan-activity; sid:81000002; rev:1;)

alert ftp $INTERNAL_NETWORK any -> !$INTERNAL_NETWORK any (msg:"[QUADRANT] Multiple directories created via MKD command"; flow:established,to_server; content:"MKD"; offset:0; depth:3; threshold:type both,track by_both, count 50, seconds 300; classtype:trojan-activity; sid:81000003; rev:1;)

alert http $INTERNAL_NETWORK any -> any any (msg:"[QUADRANT] OpenSSL Critical version found m1"; flow:established,from_server; http.header; content:"OpenSSL|2f|3.0."; nocase; content:!"OpenSSL/3.0.7"; nocase; threshold:type both, track by_src, count 1, seconds 3600; reference:url,www.zdnet.com/article/openssl-warns-of-critical-security-vulnerability-with-upcoming-patch/; reference:cve,2022-2274; classtype:misc-activity; sid:81000004; rev:1;)

alert http $INTERNAL_NETWORK any -> any any (msg:"[QUADRANT] OpenSSL Critical version found m2"; flow:established,to_server; http.header; content:"OpenSSL|2f|3.0."; nocase; content:!"OpenSSL|2f|3.0.7"; nocase; threshold:type both, track by_src, count 1, seconds 3600; reference:url,www.zdnet.com/article/openssl-warns-of-critical-security-vulnerability-with-upcoming-patch/; reference:cve,2022-2274; classtype:misc-activity; sid:81000005; rev:1;)

#alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind objectcategory=computer request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|08|computer|30|"; nocase; distance:1; within:10; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000006; rev:1;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind objectcategory=users request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|06|person|30|"; nocase; distance:1; within:10; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000007; rev:1;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind User Access Control Password Not Required Request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|09|computers"; nocase; distance:1; within:10; content:"1.2.840.113556.1.4.803"; distance:1; content:"useraccountcontrol"; distance:0; content:"|33|"; distance:2; within:1; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000008; rev:1;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind objectcategory=trustdmp request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|0d|trustedDomain|30|"; nocase; distance:1; within:15; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000009; rev:1;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind objectcategory=subnet request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|06|subnet|30|"; nocase; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000010; rev:1;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind objectcategory=group request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|05|group|30|"; nocase; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000011; rev:1;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind objectcategory=organizationalUnit request"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; content:"|12|organizationalUnit|30|"; nocase; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000012; rev:1;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind administrators list"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|04|name"; nocase; distance:0; content:"|0e|administrators|30|"; nocase; distance:1; within:16; content:"member"; distance:0; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000013; rev:2;)

alert tcp $INTERNAL_NETWORK any -> $INTERNAL_NETWORK 389 (msg:"[QUADRANT] Possible ADFind objectcategory=dcmode"; flow:established,to_server; content:"DC="; content:"|0a 01 02 0a 01|"; distance:0; content:"|0e|objectcategory"; nocase; distance:0; content:"|07|ntdsdsa|30|"; nocase; distance:1; within:9; reference:url,thedfirreport.com/2020/05/08/adfind-recon/; reference:url,www.ietf.org/rfc/rfc2251.txt; sid:81000014; rev:1;)

alert tls $INTERNAL_NETWORK any -> $EXTERNAL_NET any (msg:"[QUADRANT] downloads.rclone.org TLS SNI Detected"; flow:established,to_server; tls.sni; content:"downloads.rclone.org"; nocase; classtype:trojan-activity; sid:81000015; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)

alert http $INTERNAL_NETWORK any -> $EXTERNAL_NET any (msg:"[QUADRANT] Rclone User-Agent Detected - Possible Exfil"; flow:established,to_server; http.user_agent; content:"rclone"; classtype:trojan-activity; sid:81000016; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)

alert http $INTERNAL_NETWORK any -> $EXTERNAL_NET any (msg:"[QUADRANT] Rclone User-Agent POST to Mega - Possible Exfil"; flow:established,to_server; http.method; content:"POST"; http.host; content:".userstorage.mega."; http.user_agent; content:"rclone"; classtype:trojan-activity; sid:81000017; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)

alert dns $INTERNAL_NETWORK any -> any any (msg:"[QUADRANT] DNS Query for userstorage.mega. - Possible Exfil"; dns.query; content:"userstorage.mega."; classtype:trojan-activity; sid:81000018; rev:1; metadata:deployment Perimeter,affected_product NONE,affected_version NONE,mitigation NONE,deprecation_reason NONE,tag NONE, created_at 2023_02_07, updated_at 2023_02_07, mitre_tactic_id TA0010, mitre_technique_id T1567.002;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "JSP Webshell Upload Detected - CVE-2024-53677"; http.method; content: "POST"; pcre:"/----WebKitFormBoundary[a-zA-Z0-9]{16}/"; content: ".jsp"; http.referer; content:"upload.action"; http.stat_code; content: "200"; xbits: set,jsp_upload,track ip_src, expire 604800; classtype: targeted-activity; reference:url,https://thehackernews.com/2024/12/patch-alert-critical-apache-struts-flaw.html?_m=3n%2e009a%2e3542%2ezq0ao0cdsz%2e2k6u; reference:url,https://github.com/TAM-K592/CVE-2024-53677-S2-067/blob/ALOK/S2-067.py; reference:cve,CVE-2024-53677; metadata: type RCE_UPLOAD, creation_date 2024_12_18; sid:81000019; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"JSP Webshell Command after Exploitation Detected"; flow: established,to_server; http.method; content:"GET"; http.uri; content:".jsp?cmd="; fast_pattern; reference:url,https://github.com/TAM-K592/CVE-2024-53677-S2-067/blob/ALOK/S2-067.py; xbits: isset,jsp_upload,track ip_src, expire 259200; classtype:web-application-attack; priority: 1; sid:81000020; rev:1; metadata:attack_target Web_Server, created_at 2024_12_18, confidence High, signature_severity Major, type RCE;)
